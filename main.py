# Shadi Mohagheghi  November 2019

import networkx as nx
import sys
sys.path.append("numpy_path")
from numpy import linalg as LA
import math
import numpy as np 
#import matplotlib
from numpy import inf
#matplotlib.rc('xtick', labelsize=25)
#matplotlib.rc('ytick', labelsize=25)
from random import random
import matplotlib.pyplot as plt
import scipy.stats as st
#from NetworkFormation_0 import Formation
#from NetworkFormation_1 import Formation1
from NetworkFormation import Formation
from check_stability import Stability
from check_efficiency import Efficiency
#import matplotlib.animation as animation
from optimality import Graph_Value
import time

#plt.close("all")

##  delta=0.5, c=0.2
####################
# line with 8 nodes 

def drange(start, stop, step):
	r = start
	while r < stop:
		yield r
		r += step

'''
W_interconnection=[[1    , 0.29   , 0.11 , 0.11 , 0.11 , 0.11 , 0.11 , 0.11 ], \
				   [0.29 , 1      , 0.29 , 0.11 , 0.11 , 0.11 , 0.11 , 0.11 ], \
				   [0.11 , 0.29   , 1    , 0.29 , 0.11 , 0.11 , 0.11 , 0.11 ], \
				   [0.11 , 0.11   , 0.29 , 1    , 0.29 , 0.11 , 0.11 , 0.11 ], \
				   [0.11 , 0.11   , 0.11 , 0.29, 1     , 0.29 , 0.11 , 0.11 ], \
				   [0.11 , 0.11   , 0.11 , 0.11 , 0.29 , 1    , 0.29 , 0.11 ], \
				   [0.11 , 0.11   , 0.11 , 0.11 , 0.11 , 0.29 , 1    , 0.29], \
				   [0.11 , 0.11   , 0.11 , 0.11 , 0.11 , 0.11 , 0.29 , 1   ]]
# star with 8 nodes
W_interconnection=[[1    , 0.29   , 0.29 , 0.29 , 0.29 , 0.29 , 0.29 , 0.29 ], \
				   [0.29 , 1      , 0.11 , 0.11 , 0.11 , 0.11 , 0.11 , 0.11 ], \
				   [0.29 , 0.11   , 1    , 0.11 , 0.11 , 0.11 , 0.11 , 0.11 ], \
				   [0.29 , 0.11   , 0.11 , 1    , 0.11 , 0.11 , 0.11 , 0.11 ], \
				   [0.29 , 0.11   , 0.11 , 0.11, 1     , 0.11 , 0.11 , 0.11 ], \
				   [0.29 , 0.11   , 0.11 , 0.11 , 0.11 , 1    , 0.11 , 0.11 ], \
				   [0.29 , 0.11   , 0.11 , 0.11 , 0.11 , 0.11 , 1    , 0.11], \
				   [0.29 , 0.11   , 0.11 , 0.11 , 0.11 , 0.11 , 0.11 , 1   ]]


# dumbell with 8 nodes
W_interconnection=[[1    , 0.31   , 0.31 , 0.31 , 0.31 , 0.11 , 0.11 , 0.11 ], \
				   [0.31 , 1      , 0.11 , 0.11 , 0.11 , 0.31 , 0.31 , 0.31 ], \
				   [0.31 , 0.11   , 1    , 0.11 , 0.11 , 0.11 , 0.11 , 0.11 ], \
				   [0.31 , 0.11   , 0.11 , 1    , 0.11 , 0.11 , 0.11 , 0.11 ], \
				   [0.31 , 0.11   , 0.11 , 0.11, 1     , 0.11 , 0.11 , 0.11 ], \
				   [0.11 , 0.31   , 0.11 , 0.11 , 0.11 , 1    , 0.11 , 0.11 ], \
				   [0.11 , 0.31   , 0.11 , 0.11 , 0.11 , 0.11 , 1    , 0.11], \
				   [0.11 , 0.31   , 0.11 , 0.11 , 0.11 , 0.11 , 0.11 , 1   ]]

# dumbell with 6 nodes
W_interconnection=[[1    , 0.32   , 0.32 , 0.32 ,  0.11 , 0.11 ], \
				   [0.32 , 1      , 0.11 , 0.11 ,  0.32 , 0.32 ], \
				   [0.32 , 0.11   , 1    , 0.11 ,  0.11 , 0.11 ], \
				   [0.32 , 0.11   , 0.11 , 1    ,  0.11 , 0.11 ], \
				   [0.11 , 0.32   , 0.11 , 0.11 ,  1    , 0.11 ], \
				   [0.11 , 0.32   , 0.11 , 0.11 ,  0.11 ,  1    ]]

# line with 8 nodes
W_interconnection=[[1    , 0.39   , 0.11 , 0.11 , 0.11 , 0.11 , 0.11 , 0.11 ], \
				   [0.39 , 1      , 0.39 , 0.11 , 0.11 , 0.11 , 0.11 , 0.11], \
				   [0.11 , 0.39   , 1    , 0.39 , 0.11 , 0.11 , 0.11 , 0.11], \
				   [0.11 , 0.11   , 0.39 , 1    , 0.39 , 0.11 , 0.11 , 0.11], \
				   [0.11 , 0.11   , 0.11 , 0.39 , 1    , 0.39 , 0.11 , 0.11], \
				   [0.11 , 0.11   , 0.11 , 0.11 , 0.39 , 1    , 0.39 , 0.11],\
				   [0.11 , 0.11   , 0.11 , 0.11 , 0.11 , 0.39 , 1    , 0.39], \
				   [0.11 , 0.11   , 0.11 , 0.11 , 0.11 , 0.11 , 0.39 , 1   ]]


# b-tree with 8 nodes
W_interconnection=[[1    , 0.29   , 0.29 , 0.11 , 0.11 , 0.11 , 0.11 , 0.11 ], \
				   [0.29 , 1      , 0.11 , 0.29 , 0.29 , 0.11 , 0.11 , 0.11 ], \
				   [0.29 , 0.11   , 1    , 0.11 , 0.11 , 0.29 , 0.29 , 0.11 ], \
				   [0.11 , 0.29   , 0.11 , 1    , 0.11 , 0.11 , 0.11 , 0.11 ], \
				   [0.11 , 0.29   , 0.11 , 0.11, 1     , 0.11 , 0.11 , 0.11 ], \
				   [0.11 , 0.11   , 0.29 , 0.11 , 0.11 , 1    , 0.11 , 0.11 ], \
				   [0.11 , 0.11   , 0.29 , 0.11 , 0.11 , 0.11 , 1    , 0.29], \
				   [0.11 , 0.11   , 0.11 , 0.11 , 0.11 , 0.11 , 0.29 , 1   ]]

# dumbell with 10 nodes
W_interconnection=[[1    , 0.29   , 0.29 , 0.29 , 0.29 , 0.29 , 0.1  , 0.1   , 0.1  , 0.1 ], \
				   [0.29 , 1      , 0.1  , 0.1  , 0.1  , 0.1  , 0.29 , 0.29  , 0.29 , 0.29], \
				   [0.29 , 0.1    , 1    , 0.1  , 0.1  , 0.1  , 0.1  , 0.1   , 0.1  , 0.1], \
				   [0.29 , 0.1    , 0.1  , 1    , 0.1  , 0.1  , 0.1  , 0.1   , 0.1  , 0.1], \
				   [0.29 , 0.1    , 0.1  , 0.1  , 1    , 0.1  , 0.1  , 0.1   , 0.1  , 0.1], \
				   [0.29 , 0.1    , 0.1  , 0.1  , 0.1  , 1    , 0.1  , 0.1   , 0.1  , 0.1], \
				   [0.1  , 0.29   , 0.1  , 0.1  , 0.1  , 0.1  , 1    , 0.1   , 0.1  , 0.1], \
				   [0.1  , 0.29   , 0.1  , 0.1  , 0.1  , 0.1  , 0.1  , 1     , 0.1  , 0.1], \
				   [0.1  , 0.29   , 0.1  , 0.1  , 0.1  , 0.1  , 0.1  ,  0.1  , 1    , 0.1],\
				   [0.1  , 0.29   , 0.1  , 0.1  , 0.1  , 0.1  , 0.1  ,  0.1  , 0.1  , 1   ]]
'''

W_interconnection = [[1   , 0.25 ],\
					 [0.25 , 1   ]]

'''
# line with 3 nodes
W_interconnection = [[1     , 0.11  , 0.09 ],\
					 [0.11  , 1     , 0.11 ],\
					 [0.09   , 0.11 , 1   ]]

# line with 4 nodes
W_interconnection=[[1    ,  0.21 , 0.13 , 0.13], \
				   [0.21 , 1     , 0.21 , 0.13], \
				   [0.13 , 0.21  , 1    , 0.2],
				   [0.13 , 0.13  , 0.2 , 1  ]]


#W_interconnection=np.multiply(0.4,np.ones((4,4)))
W_interconnection=[[1, 1, 1, 1 ], \
				   [1, 1, 1, 1 ], \
				   [1, 1, 1, 1 ], \
				   [1, 1, 1, 1 ]]


# line with 5 nodes  
W_interconnection=[[1    , 0.31  , 0.13  , 0.13 , 0.13], \
				   [0.31 , 1     , 0.31  , 0.13 , 0.13], \
				   [0.13 , 0.31   , 1    , 0.31 , 0.13], \
				   [0.13 , 0.13  , 0.31  , 1    , 0.25], \
				   [0.13 , 0.13  , 0.13 , 0.25 , 1   ]]


# line with 6 nodes
W_interconnection = [[1    , 0.399, 0.19 , 0.19 , 0.19 , 0.19 ],\
					 [0.399, 1    , 0.399, 0.199, 0.19 , 0.19 ],\
					 [0.19 , 0.399, 1    , 0.399, 0.19 , 0.19 ],\
					 [0.19 , 0.199, 0.399, 1    , 0.399, 0.19 ],\
					 [0.19 , 0.19 , 0.19 , 0.399, 1    , 0.399],\
					 [0.19 , 0.19 , 0.19 , 0.199, 0.399, 1    ]]

# star with 6 nodes
W_interconnection = [[1    , 0.399, 0.399 , 0.399 , 0.399 , 0.399 ],\
					 [0.399, 1    , 0.19  , 0.19  , 0.19  , 0.19 ],\
					 [0.399 , 0.19 , 1    , 0.19  , 0.19  , 0.19 ],\
					 [0.399 , 0.19 , 0.19 , 1     , 0.19  , 0.19 ],\
					 [0.399 , 0.19 , 0.19 , 0.19  , 1     , 0.19 ],\
					 [0.399 , 0.19 , 0.19 , 0.19  , 0.19  , 1    ]]

# delta=0.9, c=0.05

# dumbell with 6 nodes
W_interconnection = [[1      , 0.0182 , 0.142  , 0.0182 , 0.0182 , 0.0182 ],\
					 [0.0182 , 1      , 0.142  , 0.0182 , 0.0182 , 0.0182 ],\
					 [0.142  , 0.142  , 1      , 0.142  , 0.0182 , 0.0182 ],\
					 [0.0182 , 0.0182 , 0.142  , 1      , 0.142  , 0.142  ],\
					 [0.0182 , 0.0182 , 0.0182 , 0.142  , 1      , 0.0182 ],\
					 [0.0182 , 0.0182 , 0.0182 , 0.142  , 0.0182 , 1      ]]

# line with 6 nodes
W_interconnection = [[1      , 0.142  , 0.0182 , 0.0182 , 0.0182 , 0.0182 ],\
					 [0.142  , 1      , 0.142  , 0.0182 , 0.0182 , 0.0182 ],\
					 [0.0182 , 0.142  , 1      , 0.142  , 0.0182 , 0.0182 ],\
					 [0.0182 , 0.0182 , 0.142  , 1      , 0.142  , 0.0182 ],\
					 [0.0182 , 0.0182 , 0.0182 , 0.142  , 1      , 0.142  ],\
					 [0.0182 , 0.0182 , 0.0182 , 0.0182 , 0.142  , 1      ]]


# dumbell with 8 nodes
W_interconnection = [[1      , 0.017  , 0.017  , 0.14   , 0.017  , 0.017  , 0.017  , 0.017  ],\
					 [0.017  , 1      , 0.017  , 0.14   , 0.017  , 0.017  , 0.017  , 0.017  ],\
					 [0.017  , 0.017  , 1      , 0.14   , 0.017  , 0.017  , 0.017  , 0.017  ],\
					 [0.14   , 0.14   , 0.14   , 1      , 0.14   , 0.017  , 0.017  , 0.017  ],\
					 [0.017  , 0.017  , 0.017  , 0.14   , 1      , 0.14   , 0.14   , 0.14   ],\
					 [0.017  , 0.017  , 0.017  , 0.017  , 0.14   , 1      , 0.017  , 0.017  ],\
					 [0.017  , 0.017  , 0.017  , 0.017  , 0.14   , 0.017  , 1      , 0.017  ],\
					 [0.017  , 0.017  , 0.017  , 0.017  , 0.14   , 0.017  , 0.017  , 1     ]]

# dumbell with 10 nodes
W_interconnection = [[1      , 0.017  , 0.017  , 0.017  , 0.14   , 0.017  , 0.017 , 0.017  , 0.017  , 0.017 ],\
					 [0.017  , 1      , 0.017  , 0.017  , 0.14   , 0.017  , 0.017 , 0.017  , 0.017  , 0.017 ],\
					 [0.017  , 0.017  , 1      , 0.017  , 0.14   , 0.017  , 0.017 , 0.017  , 0.017  , 0.017 ],\
					 [0.017  , 0.017  , 0.017  , 1      , 0.14   , 0.017  , 0.017 , 0.017  , 0.017  , 0.017 ],\
					 [0.14   , 0.14   , 0.14   , 0.14   , 1      , 0.14   , 0.017 , 0.017  , 0.017  , 0.017 ],\
					 [0.017  , 0.017  , 0.017  , 0.017  , 0.14   , 1      , 0.14  , 0.14   , 0.14   , 0.14 ],\
					 [0.017  , 0.017  , 0.017  , 0.017  , 0.017  , 0.14   , 1     , 0.017  , 0.017  , 0.017 ],\
					 [0.017  , 0.017  , 0.017  , 0.017  , 0.017  , 0.14   , 0.017 , 1      , 0.017  , 0.017 ],\
					 [0.017  , 0.017  , 0.017  , 0.017  , 0.017  , 0.14   , 0.017 , 0.017  , 1      , 0.017 ],\
					 [0.017  , 0.017  , 0.017  , 0.017  , 0.017  , 0.14   , 0.017 , 0.017  , 0.017  , 1     ]]


# dumbell with 12 nodes
W_interconnection = [[1      , 0.08  , 0.08  , 0.08   , 0.08 ,  0.171  , 0.08  , 0.08 , 0.08  , 0.08  , 0.08 , 0.08 ],\
					 [0.08  , 1      , 0.08  , 0.08   , 0.08 ,  0.171  , 0.08  , 0.08 , 0.08  , 0.08  , 0.08 , 0.08 ],\
					 [0.08  , 0.08   , 1     , 0.08   , 0.08 ,  0.171  , 0.08  , 0.08 , 0.08  , 0.08  , 0.08 , 0.08 ],\
					 [0.08  , 0.08   , 0.08  , 1      , 0.08 ,  0.171  , 0.08  , 0.08 , 0.08  , 0.08  , 0.08 , 0.08 ],\
					 [0.08  , 0.08   , 0.08  , 0.08   , 1    ,  0.171  , 0.08  , 0.08 , 0.08  , 0.08  , 0.08 , 0.08 ],\
					 [0.171 , 0.171  , 0.171 , 0.171  , 0.171,  1      , 0.171 , 0.08 , 0.08  , 0.08  , 0.08 , 0.08 ],\
					 [0.08  , 0.08  , 0.08   , 0.08   , 0.08  , 0.171  , 1     , 0.171, 0.171 , 0.171 , 0.171, 0.171],\
					 [0.08  , 0.08  , 0.08   , 0.08   , 0.08  , 0.08   , 0.171  , 1   , 0.08  , 0.08  , 0.08 , 0.08],\
					 [0.08  , 0.08  , 0.08   , 0.08   , 0.08  , 0.08   , 0.171  , 0.08 , 1    , 0.08  , 0.08 , 0.08],\
					 [0.08  , 0.08  , 0.08   , 0.08   , 0.08  , 0.08   , 0.171  , 0.08 , 0.08  , 1    , 0.08 , 0.08],\
					 [0.08  , 0.08  , 0.08   , 0.08   , 0.08  , 0.08   , 0.171  , 0.08 , 0.08  , 0.08 , 1    , 0.08],\
					 [0.08  , 0.08  , 0.08   , 0.08   , 0.08  , 0.08   , 0.171  , 0.08 , 0.08  , 0.08 , 0.08 , 1   ]]

# dumbell with 10 nodes, c=0.1, delta=0.2
W_interconnection = [[1      , 0.21  , 0.21  , 0.21  , 0.39   , 0.21  , 0.21  , 0.21  , 0.21  , 0.21 ],\
					 [0.21  , 1      , 0.21  , 0.21  , 0.39   , 0.21  , 0.21  , 0.21  , 0.21  , 0.21  ],\
					 [0.21  , 0.21   , 1     , 0.21  , 0.39   , 0.21  , 0.21  , 0.21  , 0.21  , 0.21  ],\
					 [0.21  , 0.21   , 0.21  , 1     , 0.39   , 0.21  , 0.21  , 0.21  , 0.21  , 0.21 ],\
					 [0.39  , 0.39   , 0.39  , 0.39  , 1      , 0.39  , 0.21  , 0.21  , 0.21  , 0.21 ],\
					 [0.21  , 0.21   , 0.21  , 0.21  , 0.39   , 1     , 0.39  , 0.39  , 0.39  , 0.39 ],\
					 [0.21  , 0.21   , 0.21  , 0.21  , 0.21   , 0.39  , 1     , 0.21  , 0.21  , 0.21 ],\
					 [0.21  , 0.21   , 0.21  , 0.21  , 0.21   , 0.39  , 0.21  , 1     , 0.21  , 0.21 ],\
					 [0.21  , 0.21   , 0.21  , 0.21  , 0.21   , 0.39  , 0.21  , 0.21  , 1     , 0.21 ],\
					 [0.21  , 0.21   , 0.21  , 0.21  , 0.21   , 0.39  , 0.21  , 0.21  , 0.21  , 1     ]]

# dumbell with 12 nodes, c=0.1, delta=0.2
W_interconnection = [[1      , 0.2   , 0.2   , 0.2   ,  0.2   , 0.39   , 0.2   , 0.2  , 0.2  , 0.2  , 0.2  , 0.2 ],\
					 [0.2    , 1     , 0.2   , 0.2   ,  0.2   , 0.39   , 0.2   , 0.2  , 0.2  , 0.2  , 0.2  , 0.2 ],\
					 [0.2    , 0.2   , 1     , 0.2   ,  0.2   , 0.39   , 0.2   , 0.2  , 0.2  , 0.2  , 0.2  , 0.2 ],\
					 [0.2    , 0.2   , 0.2   , 1     ,  0.2   , 0.39   , 0.2   , 0.2  , 0.2  , 0.2  , 0.2  , 0.2 ],\
					 [0.2    , 0.2   , 0.2   , 0.2   ,  1     , 0.39   , 0.2   , 0.2  , 0.2  , 0.2  , 0.2  , 0.2 ],\
					 [0.39   , 0.39  , 0.39  , 0.39  ,  0.39  , 1      , 0.39  , 0.2  , 0.2  , 0.2  , 0.2  , 0.2 ],\
					 [0.2    , 0.2   , 0.2   , 0.2   ,  0.2   , 0.39   , 1     , 0.39 , 0.39 , 0.39 , 0.39 , 0.39],\
					 [0.2    , 0.2   , 0.2   , 0.2   ,  0.2   , 0.2    , 0.39  , 1    , 0.2  , 0.2  , 0.2  , 0.2 ],\
					 [0.2    , 0.2   , 0.2   , 0.2   ,  0.2   , 0.2    , 0.39  , 0.2  , 1    , 0.2  , 0.2  , 0.2 ],\
					 [0.2    , 0.2   , 0.2   , 0.2   ,  0.2   , 0.2    , 0.39  , 0.2  , 0.2  , 1    , 0.2  , 0.2 ],\
					 [0.2    , 0.2   , 0.2   , 0.2   ,  0.2   , 0.2    , 0.39  , 0.2  , 0.2  , 0.2  , 1    , 0.2 ],\
					 [0.2    , 0.2   , 0.2   , 0.2   ,  0.2   , 0.2    , 0.39  , 0.2  , 0.2  , 0.2  , 0.2  , 1   ]
					 ]
'''
#W_interconnection=[[1]]

c=0.2
delta=0.5

Iterations = 300
trials=5
clique_sizes=[3, 5]
n=np.sum(clique_sizes)

n_iterations=[]
#u_sum=np.zeros(Iterations)
#all_U_sum=np.zeros(Iterations)
#W_interconnection=np.zeros((4,4))
W_interconnection[0][1]=0.25


W_interconnection = [[1                       , W_interconnection[0][1]],\
                     [W_interconnection[0][1] , 1                     ]]
#for i in range(trials):
#	G, u_sum=Formation(clique_sizes, W_interconnection, Iterations, c, delta)


# for 2 groups
clique_sizes=[3, 5]
k=0

for W_interconnection[0][1] in drange(0.2, 0.8, 0.025):
	#print W_interconnection_01
    W_interconnection = [[1                       , W_interconnection[0][1]],\
                         [W_interconnection[0][1] , 1                     ]]
    for i in range(trials):
		G, u_sum=Formation(clique_sizes, W_interconnection, Iterations, c, delta)
    k=k+1
'''
#for 3 groups
W_interconnection[0][2]=0.15
for W_interconnection[0][1] in drange(0.05, 1, 0.1):
	for W_interconnection[1][2] in drange(0.05, 1, 0.1):
		#print W_interconnection_01
    	W_interconnection = [[1                       , W_interconnection[0][1], W_interconnection[0][2],\
                            [W_interconnection[0][1] , 1                      , W_interconnection[1][2],\
                            [W_interconnection[0][2] , W_interconnection[1][2], 1                      ]
		for i in range(trials):
			G, u_sum=Formation(clique_sizes, W_interconnection, Iterations, c, delta)
			all_U_sum=all_U_sum+u_sum


G, u_sum=Stability(clique_sizes, W_interconnection, Iterations, c, delta)

G, u_sum=Efficiency(clique_sizes, W_interconnection, Iterations, c, delta)
for u in range(Iterations):
	n_iterations.append(u)

print u_Sum
plt.figure(2)
plt.plot(u_Sum, linewidth=2, color='b')

plt.figure()
plt.plot(n_iterations,np.divide(all_U_sum, trials), linewidth=2)
plt.show()

#2 groups, varying group sizes randomly
n=10
W_interconnection[0][1]=0.25
prob=0.5
for prob in drange(0.2, 0.8, 0.1):
	#print W_interconnection_01

	clique_sizes=np.random.choice(2, 2, p=[prob, 1-prob])
	clique_sizes+=3
	print cliques
    W_interconnection = [[1                       , W_interconnection[0][1]],\
                         [W_interconnection[0][1] , 1                     ]]
    for i in range(trials):
		#G, u_sum=Formation(clique_sizes, W_interconnection, Iterations, c, delta)
		all_U_sum=all_U_sum+u_sum



#2 groups, group sizes
n=20
size_1=0
size_2=0
W_interconnection[0][1]=0.25
W_interconnection = [[1                       , W_interconnection[0][1]],\
                     [W_interconnection[0][1] , 1                     ]]
for size_1 in range(10,11):
    size_2 =n-size_1
    clique_sizes=[size_1,size_2]
    for i in range(trials):
		G, u_sum=Formation(clique_sizes, W_interconnection, Iterations, c, delta)
		#all_U_sum=all_U_sum+u_sum

# Check graph value for 2 groups
clique_sizes=[3, 5]
u_Sum=np.zeros(40)
k=0

for W_interconnection[0][1] in drange(0.0, 0.8, 0.025):
    print W_interconnection[0][1]
    W_interconnection = [[1                       , W_interconnection[0][1]],\
                         [W_interconnection[0][1] , 1                     ]]
    for i in range(trials):
		G, u_sum=Graph_Value(clique_sizes, W_interconnection, Iterations, c, delta)
    u_Sum[k]=u_sum
    k=k+1
'''